@page "/party"
@inject LoDCompanion.Services.State.PartyManagerService PartyManager
@inject NavigationManager Navigation
@rendermode InteractiveServer

<h3>Your Party</h3>

@if (PartyManager.PartyMembers.Any())
{
    <div class="alert alert-info">
        <strong>Party Morale:</strong> @PartyManager.PartyMorale / @PartyManager.MaxPartyMorale
    </div>

    <div class="row">
        @foreach (var hero in PartyManager.GetParty())
        {
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-header">
                        <strong>@hero.Name</strong>
                    </div>
                    <div class="card-body">
                        <p class="card-text">@hero.SpeciesName @hero.ProfessionName</p>
                        <p class="card-text">Level: @hero.Level</p>
                        <p class="card-text">HP: @hero.CurrentHP / @hero.MaxHP</p>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <p>Your party is empty. Go create your first hero!</p>
}

<hr />

<div class="mt-3">
    <button class="btn btn-primary" @onclick="GoToCharacterCreation">
        <i class="fas fa-plus"></i> Add Another Character
    </button>
    <button class="btn btn-danger" @onclick="ClearParty" disabled="@(!PartyManager.PartyMembers.Any())">
        <i class="fas fa-trash"></i> Disband Party
    </button>
    <button class="btn btn-success" @onclick="StartAdventure" disabled="@(!PartyManager.PartyMembers.Any())">
        <i class="fas fa-dungeon"></i> Start Adventure!
    </button>
</div>

@code {
    private void GoToCharacterCreation()
    {
        // Navigate to the beginning of the character creation flow
        Navigation.NavigateTo("/character-creation");
    }

    private void ClearParty()
    {
        PartyManager.ClearParty();
        StateHasChanged(); // Update the UI
    }

    private void StartAdventure()
    {
        // This would navigate to your dungeon entrance or world map page
        // Navigation.NavigateTo("/dungeon");
        Console.WriteLine("Adventure Started with the current party!");
    }
}